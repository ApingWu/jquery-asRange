/*! asRange - v0.2.0 - 2014-05-27
* https://github.com/amazingSurge/jquery-asRange
* Copyright (c) 2014 amazingSurge; Licensed GPL */
!function(a){function b(b,c,d){this.$element=b,this.uid=c,this.parent=d,this.options=a.extend(!0,{},this.parent.options),this.direction=this.options.direction,this.value=null,this.classes={active:this.parent.namespace+"-pointer_active"}}var c="asRange",d={namespace:"asRange",skin:null,max:100,min:0,value:null,step:10,limit:!0,range:!1,direction:"h",keyboard:!0,replaceFirst:"default",tip:!0,scale:!0,format:function(a){return a},onChange:function(){},callback:function(){}},e=function(a){return a.touches&&(a=a.touches[0]),a},f=a[c]=function(b,c){var e={},f={v:{page:"pageY",position:"top"},h:{page:"pageX",position:"left"}};if(this.element=b,this.$element=a(b),this.$element.is("input")){var g=this.$element.val();"string"==typeof g&&(e.value=g.split(","));var h=this;a.each(["min","max","step"],function(a,b){var c=parseFloat(h.$element.attr(b));isNaN(c)||(e[b]=c)}),this.$element.css({display:"none"}),this.$wrap=a("<div></div>"),this.$element.after(this.$wrap)}else this.$wrap=this.$element;if(this.options=a.extend({},d,c,this.$element.data(),e),this.namespace=this.options.namespace,this.components=a.extend(!0,{},this.components),this.value=this.options.value,null===this.value&&(this.value=this.options.min),this.options.range?a.isArray(this.value)?1===this.value.length&&(this.value[1]=this.value[0]):this.value=[this.value,this.value]:a.isArray(this.value)&&(this.value=this.value[0]),this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.interval=this.max-this.min,this.initialized=!1,this.updating=!1,this.disabled=!1,this.page=f[this.options.direction].page,this.position=f[this.options.direction].position,this.$wrap.addClass(this.namespace),this.options.skin&&this.$wrap.addClass(this.namespace+"_"+this.options.skin),this.max<this.min||this.step>=this.interval)throw new Error("error options about max min step");this.init()};f.prototype={constructor:f,components:{},init:function(){this.$wrap.append('<div class="'+this.namespace+'-bar" />'),this.buildPointers(),this.components.selected.init(this),this.options.tip!==!1&&this.components.tip.init(this),this.options.scale!==!1&&this.components.scale.init(this),this.set(this.value),this.bindEvents(),this.$element.trigger("asRange::ready",this),this.initialized=!0},buildPointers:function(){this.pointer=[];var c=1;this.options.range&&(c=2);for(var d=1;c>=d;d++){var e=a('<div class="'+this.namespace+"-pointer "+this.namespace+"-pointer-"+d+'"></div>').appendTo(this.$wrap),f=new b(e,d,this);this.pointer.push(f)}this.p1=this.pointer[0],this.options.range&&(this.p2=this.pointer[1])},bindEvents:function(){var b=this;this.$wrap.on("touchstart.asRange mousedown.asRange",function(a){a=e(a);var c=a.which?3===a.which:2===a.button;if(c&&!Touch)return!1;var d=b.$wrap.offset(),f=a[b.page]-d[b.position],g=b.getAdjacentPointer.call(b,f);return g.mousedown.call(g,a),!1}),this.$element.is("input")&&this.$element.on("asRange::change",function(){var a=b.get();b.$element.val(a)}),a.each(this.pointer,function(a,c){c.$element.on("asRange::pointer::change",function(){return b.value=b.get(),!b.initialized||b.updating?!1:("function"==typeof b.options.onChange&&b.options.onChange.call(b,b.value,c.uid),b.$element.trigger("asRange::change",b),!1)})})},getAdjacentPointer:function(a){var b=a/this.getLength();if(this.options.range){var c=this.p1.value,d=this.p2.value,e=Math.abs(c-d);return d>=c?b>c+e/2?this.p2:this.p1:b>d+e/2?this.p1:this.p2}return this.p1},getLength:function(){return"v"===this.direction?this.$wrap.height():this.$wrap.width()},update:function(b){var c=this;this.updating=!0,a.each(["max","min","step","limit","value"],function(a,d){b[d]&&(c[d]=b[d])}),(b.max||b.min)&&this.setInterval(b.min,b.max),b.value||(this.value=b.min),a.each(this.components,function(a,b){"function"==typeof b.update&&b.update(c)}),this.set(this.value),"function"==typeof c.options.onUpdate&&c.options.onUpdate.call(c),c.$element.trigger("asRange::update",c),this.updating=!1},get:function(){var b=this,c=[],d=b.step,e=d.toString().split(".")[1]?d.toString().split(".")[1].length:0;return a.each(this.pointer,function(a,d){var f=d.get()*b.interval+b.min;f=Math.round(f/b.step)*b.step,e>0&&(f=parseFloat(f.toFixed(e))),c[a]=f}),b.options.range?c:c[0]},set:function(b){if(this.options.range){if("number"==typeof b&&(b=[b]),!a.isArray(b))return;a.each(this.pointer,function(a,c){c.set("actual",b[a])})}else this.p1.set("actual",b);this.value=b},val:function(a){return a?(this.set(a),this):this.get()},setInterval:function(a,b){this.min=a,this.max=b,this.interval=b-a},enable:function(){return this.disabled=!1,this.$wrap.removeClass(this.namespace+"_disabled"),this},disable:function(){return this.disabled=!0,this.$wrap.addClass(this.namespace+"_disabled"),this},destroy:function(){a.each(this.pointer,function(a,b){b.destroy()}),this.$wrap.destroy()}},f.defaults=d,f.registerComponent=function(a,b){f.prototype.components[a]=b},b.prototype={constructor:b,mousedown:function(b){var c,d,f=this.parent.$wrap.offset();if(this.parent.enabled!==!1)return this.$element.trigger("asRange::pointer::start",this),c=this.parent.page,d=this.parent.position,this.data={},this.data.start=b[c],this.data[d]=b[c]-f[d],this.set("px",this.data[d]),a.each(this.parent.pointer,function(a,b){b.deactive()}),this.active(),this.mousemove=function(a){var b=a,f=e(a),g=this.data[d]+(f[c]||this.data.start)-this.data.start;return this.set("px",g),b.preventDefault(),!1},this.mouseup=function(){return a(document).off("touchmove.asRange mousemove.asRange touchend.asRange mouseup.asRange"),this.$element.trigger("asRange::pointer::end",this),!1},a(document).on("touchmove.asRange mousemove.asRange",a.proxy(this.mousemove,this)).on("touchend.asRange mouseup.asRange",a.proxy(this.mouseup,this)),!1},active:function(){this.$element.addClass(this.classes.active)},deactive:function(){this.$element.removeClass(this.classes.active)},set:function(a,b){"px"===a&&(b/=this.parent.getLength()),"actual"===a&&(b=(b-this.parent.min)/this.parent.interval),"percent"===a&&(b=b),this._set(b)},_set:function(a){if(this.value!==a){a=Math.round(1e3*a)/1e3,this.parent.step>0&&(a=this.matchStep(a)),this.options.limit===!0?a=this.matchLimit(a):(0>=a&&(a=0),a>=1&&(a=1)),a=Math.round(1e3*a)/1e3,this.value=a;var b={};b[this.parent.position]=100*a+"%",this.$element.css(b),this.$element.focus(),this.$element.trigger("asRange::pointer::change",this)}},get:function(){return this.value},matchStep:function(a){var b=this.parent.step;return a=a*this.parent.interval+this.parent.min,a=Math.round(a/b)*b,(a-this.parent.min)/this.parent.interval},matchLimit:function(a){var b,c,d=this.parent.pointer;return b=1===this.uid?0:d[this.uid-2].value,c=d[this.uid]?d[this.uid].value:1,b>=a&&(a=b),a>=c&&(a=c),a},destroy:function(){this.$element.off(".asRange"),this.$element.remove()}},a.fn.asRange=function(b){if("string"!=typeof b)return this.each(function(){a.data(this,c)||a.data(this,c,new f(this,b))});var d=b,e=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;if(/^\_/.test(d))return!1;if(!(/^(get)$/.test(d)||"val"===d&&void 0===e))return this.each(function(){var b=a.data(this,c);b&&"function"==typeof b[d]&&b[d].apply(b,e)});var g=this.first().data(c);return g&&"function"==typeof g[d]?g[d].apply(g,e):void 0}}(jQuery),function(a){a.asRange.registerComponent("scale",{defaults:{scale:{values:[0,50,100],gap:1,grid:5}},init:function(b){var c=a.extend({},this.defaults,b.options.scale),d=c.scale,e={scale:b.namespace+"-scale",lines:b.namespace+"-scale-lines",grid:b.namespace+"-scale-grid",inlineGrid:b.namespace+"-scale-inlineGrid",values:b.namespace+"-scale-values"},f=d.values.length,g=((d.grid-1)*(d.gap+1)+d.gap)*(f-1)+f,h=100/(g-1),i=100/(f-1);this.$scale=a("<div></div>").addClass(e.scale),this.$lines=a("<ul></ul>").addClass(e.lines),this.$values=a("<ul></ul>").addClass(e.values);for(var j=0;g>j;j++){var k;k=a(0===j||j===g||j%((g-1)/(f-1))===0?'<li class="'+e.grid+'"></li>':j%d.grid===0?'<li class="'+e.inlineGrid+'"></li>':"<li></li>"),k.css({left:h*j+"%"}).appendTo(this.$lines)}for(var l=0;f>l;l++)a("<li><span>"+d.values[l]+"</span></li>").css({left:i*l+"%"}).appendTo(this.$values);this.$lines.add(this.$values).appendTo(this.$scale),this.$scale.appendTo(b.$wrap)},update:function(a){this.$scale.remove(),this.init(a)}})}(jQuery),function(a){a.asRange.registerComponent("selected",{defaults:{},init:function(b){var c=this;this.$arrow=a("<span></span>").appendTo(b.$wrap),this.$arrow.addClass(b.namespace+"-selected"),b.options.range===!1&&b.pointer[0].$element.on("asRange::pointer::change",function(a,b){var d=0,e=b.get();c.$arrow.css({left:0,width:100*(e-d)+"%"})}),b.options.range===!0&&(b.pointer[0].$element.on("asRange::pointer::change",function(a,d){var e=d.get(),f=b.pointer[1].get();c.$arrow.css({left:100*Math.min(e,f)+"%",width:100*Math.abs(f-e)+"%"})}),b.pointer[1].$element.on("asRange::pointer::change",function(a,d){var e=d.get(),f=b.pointer[0].get();c.$arrow.css({left:100*Math.min(f,e)+"%",width:100*Math.abs(e-f)+"%"})}))}})}(jQuery),function(a){a.asRange.registerComponent("tip",{defaults:{active:"always"},init:function(b){var c=this,d=a.extend({},this.defaults,b.options.tip);this.opts=d,this.classes={tip:b.namespace+"-tip",show:b.namespace+"-tip-show"},a.each(b.pointer,function(d,e){var f=a("<span></span>").appendTo(b.pointer[d].$element);f.addClass(c.classes.tip),"onMove"===c.opts.active&&(f.css({display:"none"}),e.$element.on("asRange::pointer::end",function(){return c.hide(f),!1}).on("asRange::pointer::start",function(){return c.show(f),!1})),e.$element.on("asRange::pointer::change",function(){var a;return a=b.options.range?b.get()[d]:b.get(),"function"==typeof b.options.format&&(a=b.options.format(a)),f.text(a),!1})})},show:function(a){a.addClass(this.classes.show),a.css({display:"block"})},hide:function(a){a.removeClass(this.classes.show),a.css({display:"none"})}})}(jQuery),function(a,b,c){var d=c(b);d.on("asRange::ready",function(a,b){var e,f={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(a){var b=a.keyCode||a.which;return b in f.map&&"function"==typeof f.map[b]?(f.map[b](a),!1):void 0},attach:function(a){var b,c;for(b in a)a.hasOwnProperty(b)&&(c=b.toUpperCase(),c in f.keys?f.map[f.keys[c]]=a[b]:f.map[c]=a[b]);f.bound||(f.bound=!0,d.bind("keydown",f.press))},detach:function(){f.bound=!1,f.map={},d.unbind("keydown",f.press)}};b.options.keyboard===!0&&c.each(b.pointer,function(a,c){e=b.options.step>0?b.options.step/b.interval:.01;var d=function(){var a=c.value;c.set("percent",a-e)},g=function(){var a=c.value;c.set("percent",a+e)};c.$element.attr("tabindex","0").on("focus",function(){return f.attach({left:d,right:g}),!1}).on("blur",function(){return f.detach(),!1})})})}(window,document,jQuery);