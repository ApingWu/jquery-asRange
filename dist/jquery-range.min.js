/*! Range - v0.1.0 - 2013-07-26
* https://github.com/amazingSurge/jquery-range
* Copyright (c) 2013 joeylin; Licensed MIT */
(function(t){function e(e,i,n){this.$element=e,this.uid=i,this.parent=n,this.options=t.extend(!0,{},this.parent.options),this.interval=this.parent.interval,this.value=null,this.direction=n.direction,this.mouse=n.mouse,this.maxDimesion=n.maxDimesion,this.init()}e.prototype={constructor:e,init:function(){this.$element.on("mousedown",t.proxy(this.mousedown,this))},mousedown:function(e){var i={},n=this.parent.$element.offset();if(this.parent.enabled!==!1)return this.data={},this.data.start=e[this.mouse],this.data[this.direction]=e[this.mouse]-n[this.direction],this._set(this.data[this.direction]),t.each(this.parent.pointer,function(t,e){e.$element.removeClass("pointer-active")}),this.$element.addClass("pointer-active"),this.mousemove=function(t){var e=this.data[this.direction]+(t[this.mouse]||this.data.start)-this.data.start;return this.parent.options.limit===!0&&(i=this.limit(),i.left>e&&(e=i.left),e>i.right&&(e=i.right)),this._set(e),!1},this.mouseup=function(){return t(document).off({mousemove:this.mousemove,mouseup:this.mouseup}),"function"==typeof this.parent.options.callback&&this.parent.options.callback(this),this.$element.trigger("end",this),!1},t(document).on({mousemove:t.proxy(this.mousemove,this),mouseup:t.proxy(this.mouseup,this)}),!1},_set:function(t){var e,i,n={};0>t&&(t=0),t>this.maxDimesion&&(t=this.maxDimesion),this.options.step>0?(e=this.getActualValue(t),i=this.step(e)):i=t,i!==this.value&&(n[this.direction]=i,this.$element.css(n),this.value=i,"function"==typeof this.parent.options.onChange&&this.parent.options.onChange(this),this.$element.trigger("change",this))},getPosValue:function(t){return void 0!==t?t/this.parent.interval*this.maxDimesion:this.value},getActualValue:function(t){var e=t/this.maxDimesion*this.parent.interval+this.parent.min;return e},step:function(t){var e,i=this.options.step;return i>0&&(e=Math.round(t/i)*i),this.getPosValue(e)},limit:function(){var t,e;return t=1===this.uid?0:this.parent.pointer[this.uid-2].getPosValue(),e=this.parent.pointer[this.uid]?this.parent.pointer[this.uid].getPosValue():this.maxDimesion,{left:t,right:e}},set:function(t){t=this.getPosValue(t),this._set(t)},get:function(){var t=this.getActualValue(this.value);return this.options.format(Math.round(100*t)/100)},destroy:function(){this.$element.off("mousedown")}};var i=t.range=function(e,n){var s={};if(this.range=e,this.$range=t(e),this.$element=null,this.$range.is("input")){var o=this.$range.attr("value");s.min=parseFloat(this.$range.attr("min")),s.max=parseFloat(this.$range.attr("max")),s.step=parseFloat(this.$range.attr("step")),o&&(s.value=[],s.value.push(o)),this.$range.css({display:"none"}),this.$element=t("<div></div>"),this.$range.after(this.$element)}else this.$element=this.$range;if(this.$element.css({position:"relative"}),this.options=t.extend({},i.defaults,n,s),this.namespace=this.options.namespace,this.components=t.extend(!0,{},this.components),this.value=this.options.value,this.min=this.options.min,this.max=this.options.max,this.interval=this.max-this.min,this.initial=!1,this.enabled=!0,this.$element.addClass(this.namespace).addClass(this.options.skin),this.max<this.min||this.step<=this.interval)throw Error("error options about max min step");this.init()};i.prototype={constructor:i,components:{},init:function(){var i=this;this.pointer=[],this.width=this.$element.width(),this.height=this.$element.height(),"v"===this.options.vertical?(this.direction="top",this.mouse="pageY",this.maxDimesion=this.height):(this.direction="left",this.mouse="pageX",this.maxDimesion=this.width);for(var n=1;this.options.pointer>=n;n++){var s=t('<span class="'+this.namespace+'-pointer"></span>').appendTo(this.$element),o=new e(s,n,this);this.pointer.push(o)}this.p1=this.pointer[0],this.p2=this.pointer[1],this.components.view.init(this),this.options.tip!==!1&&this.components.tip.init(this),this.options.scale===!1&&this.components.scale.init(this),this.setValue(this.value),this.$element.on("mousedown",function(t){var e=i.$element.offset(),n=t[i.mouse]-e[i.direction],s=i.stickTo.call(i,n);return s.mousedown.call(s,t),!1}),this.$range.is("input")&&this.p1.$element.on("change",function(t,e){var n=e.get();i.$element.val(n)}),this.initial=!0},stickTo:function(t){if(1===this.options.pointer)return this.p1;if(2===this.options.pointer){var e=this.p1.getPosValue(),i=this.p2.getPosValue(),n=Math.abs(e-i);return i>=e?t>e+n/2?this.p2:this.p1:t>i+n/2?this.p1:this.p2}},getValue:function(){var e=[];return t.each(this.pointer,function(t,i){e[t]=i.get()}),e},setValue:function(e){t.each(this.pointer,function(t,i){i.set(e[t])}),this.value=e},setInterval:function(t,e){this.min=t,this.max=e,this.interval=e-t},enable:function(){return this.enabled=!0,this.$element.addClass(this.namespace+"enabled"),this},disable:function(){return this.enabled=!1,this.$element.removeClass(this.namespace+"enabled"),this},destroy:function(){t.each(this.pointer,function(t,e){e.destroy()})}},i.defaults={namespace:"range",skin:null,max:100,min:0,value:[0,20],step:10,pointer:2,limit:!0,orientation:"v",tip:!0,scale:!1,format:function(t){return t},onChange:function(){},callback:function(){}},i.registerComponent=function(t,e){i.prototype.components[t]=e},t.fn.range=function(e){if("string"==typeof e){var n=e,s=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var e=t.data(this,"range");"function"==typeof e[n]&&e[n].apply(e,s)})}return this.each(function(){t.data(this,"range")||t.data(this,"range",new i(this,e))})}})(jQuery),$.range.registerComponent("scale",{defaults:{scale:[0,50,100]},init:function(t){var e=this,i=$.extend({},this.defaults,t.options.tip),n=i.scale.length;this.$scale=$('<ul class="range-scale"></ul>'),$.each(i.scale,function(t,i){var s=$("<li>"+i+"</li>");s.css({left:100*(t/(n-1))+"%"}),s.appendTo(e.$scale)}),this.$scale.appendTo(t.$element)}}),$.range.registerComponent("view",{defaults:{},init:function(t){var e=this;this.$arrow=$('<span class="range-view"></span>').appendTo(t.$element),1===t.pointer.length&&t.pointer[0].$element.on("change",function(t,i){var n=0,s=i.getPosValue();e.$arrow.css({left:0,width:s-n})}),2===t.pointer.length&&(t.pointer[0].$element.on("change",function(i,n){var s=n.getPosValue(),o=t.pointer[1].getPosValue();e.$arrow.css({left:Math.min(s,o),width:Math.abs(o-s)})}),t.pointer[1].$element.on("change",function(i,n){var s=n.getPosValue(),o=t.pointer[0].getPosValue();e.$arrow.css({left:Math.min(o,s),width:Math.abs(s-o)})}))}}),$.range.registerComponent("tip",{defaults:{active:"always"},init:function(t){var e=this,i=$.extend({},this.defaults,t.options.tip);this.opts=i,this.tip=[],$.each(t.pointer,function(i,n){var s=$('<span class="range-tip"></span>').appendTo(t.pointer[i].$element);"onmove"===e.opts.active?(s.css({display:"none"}),n.$element.on("change",function(i,n){s.text(n.get()),t.initial===!0&&e.show()}),n.$element.on("end",function(){e.hide()})):n.$element.on("change",function(t,e){s.text(e.get())}),e.tip.push(s)})},show:function(){$.each(this.tip,function(t,e){e.fadeIn("slow")})},hide:function(){$.each(this.tip,function(t,e){e.fadeOut("slow")})}});