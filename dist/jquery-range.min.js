/*! Range - v0.1.2 - 2014-01-08
* https://github.com/amazingSurge/jquery-range
* Copyright (c) 2014 amazingSurge; Licensed GPL */
(function(t){function e(){var t=document.createElement("div");return t.setAttribute("ongesturestart","return;"),"function"==typeof t.ongesturestart?!0:!1}function n(e,n,i){this.$element=e,this.uid=n,this.parent=i,this.options=t.extend(!0,{},this.parent.options),this.direction=this.options.direction,this.value=null,this.classes={active:this.parent.namespace+"-pointer_active"}}var i,s,a,o=e();o?(i="touchstart.range",s="touchend.range",a="touchmove.range"):(i="mousedown.range",s="mouseup.range",a="mousemove.range");var r=function(t){var e=t.originalEvent;return o&&(e=e.touches[0]),e};n.prototype={constructor:n,mousedown:function(e){var n,i,o=this,h=this.parent.$element.offset();if(this.parent.enabled!==!1)return this.$element.trigger("range::pointer::start",this),n=this.parent.page,i=this.parent.position,this.data={},this.data.start=e[n],this.data[i]=e[n]-h[i],this.set("px",this.data[i]),t.each(this.parent.pointer,function(t,e){e.$element.removeClass(o.classes.active)}),this.$element.addClass(o.classes.active),this.mousemove=function(t){var e=t,t=r(t),s=this.data[i]+(t[n]||this.data.start)-this.data.start;return this.set("px",s),e.preventDefault(),!1},this.mouseup=function(){return t(document).off(a).off(s),this.$element.trigger("range::pointer::end",this),!1},t(document).on(a,t.proxy(this.mousemove,this)).on(s,t.proxy(this.mouseup,this)),!1},set:function(t,e){"px"===t&&(e/=this.parent.getLength()),"actual"===t&&(e/=this.parent.interval),"percent"===t&&(e=e),this._set(e)},_set:function(t){if(this.value!==t){var e={};t=Math.round(1e3*t)/1e3,this.parent.step>0&&(t=this.setStep(t)),this.options.limit===!0?t=this.setLimit(t):(0>=t&&(t=0),t>=1&&(t=1)),t=Math.round(1e3*t)/1e3,this.value=t,e[this.parent.position]=100*t+"%",this.$element.css(e),this.$element.focus(),"function"==typeof this.parent.options.onChange&&this.parent.options.onChange(this),this.$element.trigger("range::pointer::change",this)}},get:function(){return this.value},setStep:function(t){var t=t*this.parent.interval,e=this.parent.step;return t=Math.round(t/e)*e,t/this.parent.interval},setLimit:function(t){var e,n,i=this.parent.pointer;return e=1===this.uid?0:i[this.uid-2].value,n=i[this.uid]?i[this.uid].value:1,e>=t&&(t=e),t>=n&&(t=n),t},destroy:function(){this.$element.off(i),this.$element.remove()}};var h=t.range=function(e,n){var i={},s={v:{page:"pageY",position:"top"},h:{page:"pageX",position:"left"}};if(this.range=e,this.$range=t(e),this.$element=null,t.each(this.$range.data(),function(t,e){var n=RegExp("^range","i");n.test(t)&&(i[t.toLowerCase().replace(n,"")]=e)}),this.$range.is("input")){var a=this.$range.attr("value");a&&(i.value=a.split(","));var o=this;t.each(["min","max","step"],function(t,e){var n=parseFloat(o.$range.attr(e));isNaN(n)||(i[e]=n)}),this.$range.css({display:"none"}),this.$element=t("<div></div>"),this.$range.after(this.$element),this.$element.on("range::pointer::change",function(t,e){o.$range.attr("value",e.value)})}else this.$element=this.$range;if(this.$element.css({position:"relative"}),this.options=t.extend({},h.defaults,n,i),this.namespace=this.options.namespace,this.components=t.extend(!0,{},this.components),this.value=this.options.value,this.min=this.options.min,this.max=this.options.max,this.step=this.options.step,this.interval=this.max-this.min,this.initialed=!1,this.disabled=!1,this.page=s[this.options.direction].page,this.position=s[this.options.direction].position,this.$element.addClass(this.namespace),this.options.skin&&this.$element.addClass(this.namespace+"_"+this.options.skin),this.max<this.min||this.step>=this.interval)throw Error("error options about max min step");this.init()};h.prototype={constructor:h,components:{},init:function(){var e=this;this.pointer=[];for(var s=1;this.options.pointer>=s;s++){var a=t('<div class="'+this.namespace+"-pointer pointer-"+s+'"></div>').appendTo(this.$element),h=new n(a,s,this);this.pointer.push(h)}this.p1=this.pointer[0],this.p2=this.pointer[1],this.p3=this.pointer[2],this.components.view.init(this),this.options.tip!==!1&&this.components.tip.init(this),this.options.scale!==!1&&this.components.scale.init(this),this.set(this.value),this.$element.on(i,function(t){var t=r(t),n=t.which?3===t.which:2===t.button;if(n&&!o)return!1;var i=e.$element.offset(),s=t[e.page]-i[e.position],a=e.stickTo.call(e,s);return a.mousedown.call(a,t),!1}),this.$range.is("input")&&this.$element.on("range::change",function(){var t=e.get();e.$element.val(t)}),t.each(this.pointer,function(t,n){n.$element.on("range::pointer::end",function(){return e.$element.trigger("range::change",e),!1})}),this.$element.trigger("range::ready",this),this.initialed=!0},stickTo:function(t){var e=t/this.getLength();if(1===this.options.pointer)return this.p1;if(2===this.options.pointer){var n=this.p1.value,i=this.p2.value,s=Math.abs(n-i);return i>=n?e>n+s/2?this.p2:this.p1:e>i+s/2?this.p1:this.p2}},getLength:function(){return"v"===this.direction?this.$element.height():this.$element.width()},update:function(e){var n=this;t.each(["max","min","step","limit"],function(t,i){e[i]&&(n[i]=e[i])}),(e.max||e.min)&&this.setInterval(e.min,e.max),this.value=e.min,t.each(this.components,function(t,e){"function"==typeof e.update&&e.update(n)}),this.set(this.value)},get:function(){var e=this,n=[];return t.each(this.pointer,function(t,i){var s=i.get()*e.interval+e.min;s=Math.round(1e3*s)/1e3,n[t]=s}),n},set:function(e){"number"==typeof e&&(e=[e]),t.each(this.pointer,function(t,n){n.set("actual",e[t])}),this.value=e},val:function(t){return t?(this.set(t),this):this.get()},setInterval:function(t,e){this.min=t,this.max=e,this.interval=e-t},enable:function(){return this.disabled=!1,this.$element.removeClass(this.namespace+"disabled"),this},disable:function(){return this.disabled=!0,this.$element.addClass(this.namespace+"disabled"),this},destroy:function(){t.each(this.pointer,function(t,e){e.destroy()}),this.$element.destroy()}},h.defaults={namespace:"range",skin:null,max:100,min:0,value:[0,20],step:10,limit:!0,pointer:2,direction:"h",keyboard:!0,tip:!0,scale:!0,format:function(t){return t},onChange:function(){},callback:function(){}},h.registerComponent=function(t,e){h.prototype.components[t]=e},t.fn.range=function(e){if("string"==typeof e){var n=e,i=arguments.length>1?Array.prototype.slice.call(arguments,1):void 0;return this.each(function(){var e=t.data(this,"range");"function"==typeof e[n]&&e[n].apply(e,i)})}return this.each(function(){t.data(this,"range")||t.data(this,"range",new h(this,e))})}})(jQuery),$.range.registerComponent("scale",{defaults:{scale:{values:[0,50,100],gap:1,grid:5}},init:function(t){var e=$.extend({},this.defaults,t.options.scale),n=e.scale,i={scale:t.namespace+"-scale",scaleGrid:t.namespace+"-scaleGrid",scaleValue:t.namespace+"-scaleValue",grid:t.namespace+"-scale-grid",inlineGrid:t.namespace+"-scale-inlineGrid"},s=n.values.length,a=((n.grid-1)*(n.gap+1)+n.gap)*(s-1)+s,o=100/(a-1),r=100/(s-1);this.$scale=$("<div></div>").addClass(i.scale),this.$grid=$("<ul></ul>").addClass(i.scaleGrid),this.$value=$("<ul></ul>").addClass(i.scaleValue);for(var h=0;a>h;h++){var p;p=0===h||h===a||0===h%((a-1)/(s-1))?$('<li class="'+i.grid+'"></li>'):0===h%n.grid?$('<li class="'+i.inlineGrid+'"></li>'):$("<li></li>"),p.css({left:o*h+"%"}).appendTo(this.$grid)}for(var c=0;s>c;c++)$("<li><span>"+n.values[c]+"</span></li>").css({left:r*c+"%"}).appendTo(this.$value);this.$grid.add(this.$value).appendTo(this.$scale),this.$scale.appendTo(t.$element)},update:function(t){this.$scale.remove(),this.init(t)}}),$.range.registerComponent("view",{defaults:{},init:function(t){var e=this;this.$arrow=$("<span></span>").appendTo(t.$element),this.$arrow.addClass(t.namespace+"-view"),1===t.pointer.length&&t.pointer[0].$element.on("range::pointer::change",function(t,n){var i=0,s=n.get();e.$arrow.css({left:0,width:100*(s-i)+"%"})}),2===t.pointer.length&&(t.pointer[0].$element.on("range::pointer::change",function(n,i){var s=i.get(),a=t.pointer[1].get();e.$arrow.css({left:100*Math.min(s,a)+"%",width:100*Math.abs(a-s)+"%"})}),t.pointer[1].$element.on("range::pointer::change",function(n,i){var s=i.get(),a=t.pointer[0].get();e.$arrow.css({left:100*Math.min(a,s)+"%",width:100*Math.abs(s-a)+"%"})}))}}),$.range.registerComponent("tip",{defaults:{active:"always"},init:function(t){var e=this,n=$.extend({},this.defaults,t.options.tip);this.opts=n,this.classes={tip:t.namespace+"-tip",show:t.namespace+"-tip-show"},$.each(t.pointer,function(n,i){var s=$("<span></span>").appendTo(t.pointer[n].$element);s.addClass(e.classes.tip),"onMove"===e.opts.active&&(s.css({display:"none"}),i.$element.on("range::pointer::end",function(){return e.hide(s),!1}).on("range::pointer::start",function(){return e.show(s),!1})),i.$element.on("range::pointer::change",function(){var e;return e="function"==typeof t.options.format?t.options.format(t.get()[n]):t.get()[n],s.text(e),!1})})},show:function(t){t.addClass(this.classes.show),t.css({display:"block"})},hide:function(t){t.removeClass(this.classes.show),t.css({display:"none"})}}),function(t,e,n){var i=n(e);i.on("range::ready",function(t,e){var s,a={keys:{UP:38,DOWN:40,LEFT:37,RIGHT:39,RETURN:13,ESCAPE:27,BACKSPACE:8,SPACE:32},map:{},bound:!1,press:function(t){var e=t.keyCode||t.which;return e in a.map&&"function"==typeof a.map[e]&&a.map[e](t),!1},attach:function(t){var e,n;for(e in t)t.hasOwnProperty(e)&&(n=e.toUpperCase(),n in a.keys?a.map[a.keys[n]]=t[e]:a.map[n]=t[e]);a.bound||(a.bound=!0,i.bind("keydown",a.press))},detach:function(){a.bound=!1,a.map={},i.unbind("keydown",a.press)}};e.options.keyboard===!0&&(s=e.options.step>0?e.options.step/e.interval:.01,n.each(e.pointer,function(t,e){var n=function(){var t=e.value;e.set("percent",t-s)},i=function(){var t=e.value;e.set("percent",t+s)};e.$element.attr("tabindex","0").on("focus",function(){return a.attach({left:n,right:i}),!1}).on("blur",function(){return a.detach(),!1})}))})}(window,document,jQuery);